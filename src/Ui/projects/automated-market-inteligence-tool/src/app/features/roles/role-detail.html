<div class="role-detail-page">
  <!-- Breadcrumb -->
  <nav class="breadcrumb">
    <a routerLink="/">Admin</a>
    <mat-icon class="breadcrumb__separator">chevron_right</mat-icon>
    <a routerLink="/roles">Role Management</a>
    <mat-icon class="breadcrumb__separator">chevron_right</mat-icon>
    <span>{{ pageTitle() }}</span>
  </nav>

  <!-- Page Header -->
  <div class="page-header">
    <div class="page-title-section">
      <div class="entity-icon">
        <mat-icon>{{ role().icon }}</mat-icon>
      </div>
      <div class="page-title-content">
        <h1>
          {{ pageTitle() }}
          @if (!isNew()) {
            @if (role().isSystem) {
              <span class="badge badge--system">SYSTEM</span>
            } @else {
              <span class="badge badge--custom">CUSTOM</span>
            }
          }
        </h1>
        @if (!isNew()) {
          <p class="page-subtitle">{{ role().description }}</p>
        }
      </div>
    </div>
    <div class="action-buttons">
      @if (!isNew() && !role().isSystem) {
        <button mat-stroked-button (click)="onClone()">
          <mat-icon>content_copy</mat-icon>
          Clone Role
        </button>
      }
      @if (canEdit()) {
        <button mat-flat-button color="primary" (click)="onSave()">
          <mat-icon>save</mat-icon>
          {{ isNew() ? 'Create Role' : 'Save Changes' }}
        </button>
      }
    </div>
  </div>

  <!-- System Role Notice -->
  @if (role().isSystem && !isNew()) {
    <div class="notice notice--warning">
      <mat-icon class="notice__icon">warning</mat-icon>
      <span class="notice__text">
        This is a system role and cannot be modified. You can clone it to create a custom version.
      </span>
    </div>
  }

  <!-- Basic Information Card -->
  <mat-card class="section-card">
    <mat-card-header>
      <mat-card-title>Basic Information</mat-card-title>
      <mat-card-subtitle>Role identity and description</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Role Name</mat-label>
          <input
            matInput
            [value]="role().name"
            (input)="onNameChange($event)"
            [disabled]="!canEdit()"
            placeholder="Enter role name"
          />
        </mat-form-field>

        @if (!isNew()) {
          <mat-form-field appearance="outline">
            <mat-label>Created At</mat-label>
            <input matInput [value]="role().createdAt" disabled />
          </mat-form-field>
        }
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <textarea
          matInput
          [value]="role().description"
          (input)="onDescriptionChange($event)"
          [disabled]="!canEdit()"
          placeholder="Enter role description"
          rows="3"
        ></textarea>
      </mat-form-field>
    </mat-card-content>
  </mat-card>

  <!-- Permissions Card -->
  <mat-card class="section-card">
    <mat-card-header>
      <mat-card-title>Permissions</mat-card-title>
      <mat-card-subtitle>Select permissions for this role</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="permission-groups">
        @for (group of permissionGroups(); track group.name; let gi = $index) {
          <div class="permission-group">
            <div class="permission-group__header">
              <mat-icon class="permission-group__icon">{{ group.icon }}</mat-icon>
              <span>{{ group.name }}</span>
            </div>
            <div class="permission-actions">
              @for (perm of group.permissions; track perm.id; let pi = $index) {
                <mat-checkbox
                  [checked]="perm.checked"
                  [disabled]="!canEdit()"
                  (change)="onPermissionChange(gi, pi, $event.checked)"
                >
                  {{ perm.label }}
                </mat-checkbox>
              }
            </div>
          </div>
        }
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Assigned Users Card (only for existing roles) -->
  @if (!isNew()) {
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>Assigned Users</mat-card-title>
        <mat-card-subtitle>{{ totalAssignedUsers() }} users with this role</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        @if (assignedUsers().length > 0) {
          <div class="user-list">
            @for (user of assignedUsers(); track user.id) {
              <div class="user-item">
                <div class="avatar">{{ user.initials }}</div>
                <div class="user-info">
                  <div class="user-info__name">{{ user.displayName }}</div>
                  <div class="user-info__email">{{ user.email }}</div>
                </div>
              </div>
            }
          </div>

          @if (totalAssignedUsers() > assignedUsers().length) {
            <div class="view-all-button">
              <button mat-stroked-button>
                View All {{ totalAssignedUsers() }} Users
              </button>
            </div>
          }
        } @else {
          <div class="empty-state">
            <mat-icon class="empty-state__icon">person_off</mat-icon>
            <p class="empty-state__text">No users assigned to this role</p>
          </div>
        }
      </mat-card-content>
    </mat-card>

    <!-- Danger Zone (only for custom roles) -->
    @if (!role().isSystem) {
      <mat-card class="section-card danger-zone">
        <mat-card-header>
          <mat-card-title class="danger-title">Danger Zone</mat-card-title>
          <mat-card-subtitle>Irreversible actions</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="danger-action">
            <div class="danger-action__info">
              <div class="danger-action__title">Delete Role</div>
              <div class="danger-action__description">
                Permanently delete this role. Users will lose these permissions immediately.
              </div>
            </div>
            <button mat-stroked-button color="warn" (click)="onDelete()">
              <mat-icon>delete</mat-icon>
              Delete Role
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    }
  }
</div>
